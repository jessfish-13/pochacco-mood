<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pochacco Focus üêæ</title>
<link href="https://fonts.googleapis.com/css2?family=Hubballi&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: 'Hubballi', sans-serif;
  background: linear-gradient(135deg, #e9fff2, #f4fff9);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}
.card {
  background: white;
  width: 380px;
  padding: 20px;
  border-radius: 22px;
  border: 3px solid #c9f2dc;
  box-shadow: 0 12px 30px rgba(0,0,0,0.08);
  overflow-y: auto;
  max-height: 90vh;
}
h1 { text-align:center; color:#4fbf90; margin:0; }
.sub { text-align:center; font-size:13px; color:#7ac7a6; margin-bottom:10px; }
input, textarea, select, button {
  font-family:'Hubballi',sans-serif;
  width:100%;
  padding:8px;
  margin:5px 0;
  border-radius:14px;
  border:1px solid #bfead3;
}
button {
  background:#a8e6c8;
  border:none;
  cursor:pointer;
}
button:hover { background:#8fd9b6; }
.subject {
  background:#eafff3;
  padding:8px;
  border-radius:14px;
  margin:6px 0;
  text-align:center;
  cursor:pointer;
}
.task {
  background:#f2fff8;
  border-radius:12px;
  padding:8px;
  margin:6px 0;
}
.tag { font-size:11px; color:#4fbf90; margin-right:4px; }
.pinned {
  background:#e3fff1;
  border-left:4px solid #4fbf90;
  padding:6px;
  margin:5px 0;
  font-size:13px;
}
.music button { margin-top:4px; }
</style>
</head>

<body>
<div class="card" id="app"></div>

<script>
let data = JSON.parse(localStorage.getItem("pochacco")) || {};
let audio = null;

function save() {
  localStorage.setItem("pochacco", JSON.stringify(data));
}

function home() {
  const app = document.getElementById("app");
  app.innerHTML = `
    <h1>üêæ Pochacco Focus</h1>
    <div class="sub">focus. rest. squish.</div>

    <button onclick="newSubject()">‚ûï add subject</button>
    ${Object.keys(data).map(s=>`<div class="subject" onclick="openSubject('${s}')">${s}</div>`).join("")}

    <div class="music">
      <div class="sub">focus music</div>
      <button onclick="play('rain')">üåß rain</button>
      <button onclick="play('cafe')">‚òï cafe</button>
      <button onclick="play('lofi')">üé∂ lofi</button>
      <button onclick="play('fire')">üî• campfire</button>
      <button onclick="stop()">‚èπ stop</button>
    </div>
  `;
}

function newSubject() {
  const name = prompt("subject name");
  if (!name) return;
  data[name] = { tasks: [], notes: "", pins: [] };
  save();
  home();
}

function openSubject(s) {
  const subj = data[s];
  const app = document.getElementById("app");
  app.innerHTML = `
    <h1>${s}</h1>

    <div class="sub">pinned</div>
    ${subj.pins.map(p=>`<div class="pinned">${p}</div>`).join("")}
    <input id="pinText" placeholder="add pinned note">
    <button onclick="addPin('${s}')">pin</button>

    <div class="sub">notes</div>
    <textarea rows="4" oninput="saveNotes('${s}',this.value)">${subj.notes}</textarea>

    <div class="sub">tasks</div>
    <input id="taskText" placeholder="task + #tags">
    <input type="date" id="taskDate">
    <button onclick="addTask('${s}')">add task</button>

    ${subj.tasks.map((t,i)=>`
      <div class="task">
        ${t.text}
        <div>${t.tags.map(tag=>`<span class="tag">#${tag}</span>`).join("")}</div>
        ${t.date || ""}
        <button onclick="delTask('${s}',${i})">‚úñ</button>
      </div>
    `).join("")}

    <button onclick="home()">‚Üê back</button>
  `;
}

function addPin(s) {
  const text = document.getElementById("pinText").value;
  if (!text) return;
  data[s].pins.push(text);
  save();
  openSubject(s);
}

function saveNotes(s,val) {
  data[s].notes = val;
  save();
}

function addTask(s) {
  const text = document.getElementById("taskText").value;
  const date = document.getElementById("taskDate").value;
  if (!text) return;
  const tags = text.match(/#\w+/g)?.map(t=>t.slice(1)) || [];
  data[s].tasks.push({ text, date, tags });
  save();
  openSubject(s);
}

function delTask(s,i) {
  data[s].tasks.splice(i,1);
  save();
  openSubject(s);
}

function play(type) {
  stop();
  const sounds = {
    rain: "https://cdn.pixabay.com/audio/2022/03/15/audio_0e7a3c8b4f.mp3",
    cafe: "https://cdn.pixabay.com/audio/2022/02/23/audio_7c2d1f7f63.mp3",
    lofi: "https://cdn.pixabay.com/audio/2022/03/15/audio_5c5c8d41b5.mp3",
    fire: "https://cdn.pixabay.com/audio/2021/10/30/audio_8d8c71a1d0.mp3"
  };
  audio = new Audio(sounds[type]);
  audio.loop = true;
  audio.volume = 0.4;
  audio.play();
}

function stop() {
  if (audio) audio.pause();
}

home();
</script>
</body>
</html>
