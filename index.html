<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pochacco Focus üêæ</title>
<link href="https://fonts.googleapis.com/css2?family=Hubballi&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: 'Hubballi', sans-serif;
  background: linear-gradient(135deg, #e9fff2, #f4fff9);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.card {
  background: white;
  width: 390px;
  padding: 18px;
  border-radius: 22px;
  border: 3px solid #c9f2dc;
  box-shadow: 0 12px 30px rgba(0,0,0,0.08);
  max-height: 92vh;
  overflow-y: auto;
}

h1 {
  text-align:center;
  color:#4fbf90;
  margin:0;
}

.sub {
  text-align:center;
  font-size:13px;
  color:#7ac7a6;
  margin-bottom:10px;
}

input, textarea, select, button {
  font-family:'Hubballi',sans-serif;
  width:100%;
  padding:8px;
  margin:5px 0;
  border-radius:14px;
  border:1px solid #bfead3;
}

button {
  background:#a8e6c8;
  border:none;
  cursor:pointer;
}

button:hover {
  background:#8fd9b6;
}

.subject {
  background:#eafff3;
  padding:8px;
  border-radius:14px;
  margin:6px 0;
  display:flex;
  align-items:center;
  gap:8px;
  cursor:pointer;
}

.subject img {
  width:28px;
}

.task {
  background:#f2fff8;
  border-radius:12px;
  padding:8px;
  margin:6px 0;
}

.task.done {
  opacity:0.5;
  text-decoration: line-through;
}

.tag {
  font-size:11px;
  color:#4fbf90;
  margin-right:4px;
}

.pinned {
  background:#e3fff1;
  border-left:4px solid #4fbf90;
  padding:6px;
  margin:5px 0;
  display:flex;
  justify-content:space-between;
}

.timer {
  text-align:center;
  margin:10px 0;
}

.time {
  font-size:32px;
  color:#4fbf90;
}

.peace {
  text-align:center;
  margin-top:12px;
}

.paws {
  display:flex;
  justify-content:center;
  gap:10px;
  margin-top:6px;
}

.paw {
  width:36px;
  height:36px;
  background:#c9f2dc;
  border-radius:50%;
  cursor:pointer;
  transition:transform .1s;
}

.paw:active {
  transform:scale(0.75);
}

#pochaccoPop {
  text-align:center;
  margin:10px 0;
}
</style>
</head>

<body>
<div class="card" id="app"></div>

<audio id="alarmSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_477f7cfa3c.mp3"></audio>

<script>
let data = JSON.parse(localStorage.getItem("pochacco")) || {};
let streak = parseInt(localStorage.getItem("streak")) || 0;
let lastSessionDay = localStorage.getItem("lastDay") || "";

let defaultMinutes = 25;
let time = defaultMinutes * 60;
let timer = null;

// HOME
function home() {
  const app = document.getElementById("app");
  app.innerHTML = `
    <h1>üêæ Pochacco Focus</h1>
    <div class="sub">focus. rest. squish.</div>

    <div class="sub">current streak: ${streak} üå±</div>

    <input id="quickTask" placeholder="quick task + #tags üçÉ">
    <button onclick="addInboxTask()">add task</button>

    <div class="timer">
      <div class="sub">focus time (minutes)</div>
      <input type="number" min="1" placeholder="25" id="customTime">
      <button onclick="setCustomTime()">set time</button>

      <div class="time" id="time">${formatTime()}</div>
      <button onclick="start()">start</button>
      <button onclick="reset()">reset</button>
    </div>

    <button onclick="newSubject()">‚ûï add subject</button>

    ${Object.keys(data).filter(s=>!data[s].archived).map(s=>`
      <div class="subject" onclick="openSubject('${s}')">
        <img src="https://i.imgur.com/9R8QqjC.png">
        ${s}
      </div>
    `).join("")}

    <button onclick="viewArchived()">archived subjects</button>

    <select>
      <option>how do you feel?</option>
      <option>üòä good</option>
      <option>üò¥ tired</option>
      <option>ü•∫ low</option>
      <option>üòµ stressed</option>
    </select>

    <div class="peace">
      peace corner üåø
      <div class="paws">
        <div class="paw"></div>
        <div class="paw"></div>
        <div class="paw"></div>
      </div>
    </div>
  `;
}

// SUBJECT PAGE
function openSubject(s) {
  const subj = data[s];
  const app = document.getElementById("app");
  app.innerHTML = `
    <h1>${s}</h1>

    <div class="sub">pinned</div>
    ${subj.pins.map((p,i)=>`
      <div class="pinned">
        ${p}
        <button onclick="delPin('${s}',${i})">‚úñ</button>
      </div>
    `).join("")}
    <input id="pinText" placeholder="add pinned note">
    <button onclick="addPin('${s}')">pin</button>

    <div class="sub">tasks</div>
    <input id="taskText" placeholder="task + #tags">
    <input type="date" id="taskDate">
    <button onclick="addTask('${s}')">add task</button>

    ${subj.tasks.map((t,i)=>`
      <div class="task ${t.done?'done':''}">
        ${t.text}
        <div>${t.tags.map(tag=>`<span class="tag">#${tag}</span>`).join("")}</div>
        ${t.date || ""}
        <button onclick="toggleTask('${s}',${i})">‚úî</button>
        <button onclick="delTask('${s}',${i})">‚úñ</button>
      </div>
    `).join("")}

    <button onclick="archiveSubject('${s}')">archive subject</button>
    <button onclick="home()">‚Üê back</button>
  `;
}

// SUBJECT LOGIC
function newSubject() {
  const name = prompt("subject name");
  if (!name) return;
  data[name] = { tasks:[], pins:[], archived:false };
  save();
  home();
}

function archiveSubject(s) {
  data[s].archived = true;
  save();
  home();
}

function viewArchived() {
  const app = document.getElementById("app");
  app.innerHTML = `
    <h1>archived</h1>
    ${Object.keys(data).filter(s=>data[s].archived).map(s=>`
      <div class="subject" onclick="restore('${s}')">
        ${s}
      </div>
    `).join("")}
    <button onclick="home()">‚Üê back</button>
  `;
}

function restore(s) {
  data[s].archived = false;
  save();
  home();
}

function addPin(s) {
  const v = document.getElementById("pinText").value;
  if (!v) return;
  data[s].pins.push(v);
  save();
  openSubject(s);
}

function delPin(s,i) {
  data[s].pins.splice(i,1);
  save();
  openSubject(s);
}

function addTask(s) {
  const text = document.getElementById("taskText").value;
  const date = document.getElementById("taskDate").value;
  if (!text) return;
  const tags = text.match(/#\w+/g)?.map(t=>t.slice(1)) || [];
  data[s].tasks.push({ text, date, tags, done:false });
  save();
  openSubject(s);
}

function toggleTask(s,i) {
  data[s].tasks[i].done = !data[s].tasks[i].done;
  save();
  openSubject(s);
}

function delTask(s,i) {
  data[s].tasks.splice(i,1);
  save();
  openSubject(s);
}

function addInboxTask() {
  const text = document.getElementById("quickTask").value;
  if (!text) return;
  if (!data["Inbox"]) data["Inbox"] = { tasks:[], pins:[], archived:false };
  const tags = text.match(/#\w+/g)?.map(t=>t.slice(1)) || [];
  data["Inbox"].tasks.push({ text, date:"", tags, done:false });
  save();
  document.getElementById("quickTask").value = "";
}

// TIMER
function setCustomTime() {
  const v = parseInt(document.getElementById("customTime").value);
  if (!v) return;
  defaultMinutes = v;
  reset();
}

function start() {
  if (timer) return;
  timer = setInterval(()=>{
    time--;
    document.getElementById("time").textContent = formatTime();
    if (time === 0) finishSession();
  },1000);
}

function finishSession() {
  clearInterval(timer);
  timer = null;
  time = defaultMinutes * 60;

  document.getElementById("alarmSound").play();

  const today = new Date().toDateString();
  if (lastSessionDay !== today) {
    streak++;
    lastSessionDay = today;
    localStorage.setItem("streak", streak);
    localStorage.setItem("lastDay", today);
  }

  document.getElementById("app").insertAdjacentHTML("afterbegin",`
    <div id="pochaccoPop">
      <img src="https://i.imgur.com/WvJrQJQ.png" width="120">
    </div>
  `);

  save();
}

function reset() {
  clearInterval(timer);
  timer = null;
  time = defaultMinutes * 60;
  home();
}

function formatTime() {
  const m = Math.floor(time/60);
  const s = time%60;
  return `${m}:${s.toString().padStart(2,"0")}`;
}

function save() {
  localStorage.setItem("pochacco", JSON.stringify(data));
}

home();
</script>
</body>
</html>
