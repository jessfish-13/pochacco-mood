<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Focus App</title>
<link href="https://fonts.googleapis.com/css2?family=Hubballi&display=swap" rel="stylesheet">

<style>
:root {
  --bg:#e9fff2;
  --card:#ffffff;
  --accent:#4fbf90;
  --text:#000000;
}

body {
  margin:0;
  font-family:'Hubballi',sans-serif;
  background:var(--bg);
  color:var(--text);
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

.card {
  position:relative;
  background:var(--card);
  width:390px;
  padding:18px;
  border-radius:22px;
  border:3px solid #c9f2dc;
  box-shadow:0 12px 30px rgba(0,0,0,0.08);
  max-height:92vh;
  overflow-y:auto;
}

.topbar {
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.title-row {
  display:flex;
  justify-content:center;
  align-items:center;
  gap:14px;
  margin:10px 0;
}

.title-row h1 {
  margin:0;
}

.mascot {
  width:64px;
  height:auto;
}

button,input,textarea {
  width:100%;
  padding:8px;
  margin:5px 0;
  border-radius:14px;
  border:1px solid #bfead3;
  font-family:inherit;
}

button {
  background:#a8e6c8;
  border:none;
  cursor:pointer;
}

button:hover { background:#8fd9b6; }

.subject,.task,.pin {
  background:#f2fff8;
  padding:8px;
  border-radius:12px;
  margin:6px 0;
  position:relative;
}

.task.done {
  opacity:0.5;
  text-decoration:line-through;
}

.task input[type="checkbox"] {
  margin-right:6px;
}

.task .delete {
  position:absolute;
  top:6px;
  right:8px;
  background:none;
  border:none;
  cursor:pointer;
}

.pin {
  background:#e3fff1;
  border-left:4px solid #4fbf90;
}

.tab {
  display:flex;
  gap:8px;
  margin-bottom:10px;
}

.tab button { flex:1; }

.theme {
  padding:10px;
  border-radius:12px;
  margin:6px 0;
  cursor:pointer;
  text-align:center;
}
</style>
</head>

<body>
<div class="card" id="app"></div>

<audio id="alarm" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
const characterImages = {
  Pochacco: "images/pochacco.png",
  Kuromi: "images/kuromi.png",
  Keroppi: "images/keroppi.png",
  Cinnamoroll: "images/cinnamoroll.png"
};

let data = JSON.parse(localStorage.getItem("pochacco")) || {};
let user = JSON.parse(localStorage.getItem("user")) || { name:"", avatar:"" };
let settings = JSON.parse(localStorage.getItem("settings")) || {
  bg:"#e9fff2",
  text:"#000000",
  character:"Pochacco"
};

/* ‚úÖ CUSTOM TIMER VARIABLES */
let defaultMinutes = 25;
let time = defaultMinutes * 60;
let timer = null;

function saveAll(){
  localStorage.setItem("pochacco",JSON.stringify(data));
  localStorage.setItem("user",JSON.stringify(user));
  localStorage.setItem("settings",JSON.stringify(settings));
}

function applyTheme(){
  document.documentElement.style.setProperty("--bg",settings.bg);
  document.documentElement.style.setProperty("--text",settings.text);
}
applyTheme();

function home(){
  const app=document.getElementById("app");
  app.innerHTML=`
    <div class="topbar">
      <button onclick="settingsPage()">‚öô settings</button>
      <div style="display:flex;gap:6px;align-items:center">
        ${user.avatar?`<img src="${user.avatar}" style="width:32px;height:32px;border-radius:50%">`:""}
        ${user.name}
      </div>
    </div>

    <div class="title-row">
      <h1>üêæ ${settings.character} Focus</h1>
      <img src="${characterImages[settings.character]}" class="mascot">
    </div>

    <input id="quickTask" placeholder="quick task">
    <button onclick="addInbox()">add</button>

    <div style="text-align:center;margin:10px 0">
      <input 
        id="customTime" 
        type="number" 
        min="1" 
        placeholder="minutes (default 25)">
      <button onclick="setCustomTime()">set time</button>

      <div id="time">${format()}</div>
      <button onclick="start()">start</button>
      <button onclick="reset()">reset</button>
    </div>

    <button onclick="newSubject()">‚ûï subject</button>
    ${Object.keys(data).map(s=>`
      <div class="subject" onclick="openSubject('${s}')">${s}</div>
    `).join("")}
  `;
}

/* ‚úÖ CUSTOM TIMER FUNCTION */
function setCustomTime(){
  const input = document.getElementById("customTime");
  const minutes = parseInt(input.value);
  if(!minutes || minutes <= 0) return;

  defaultMinutes = minutes;
  time = defaultMinutes * 60;
  document.getElementById("time").textContent = format();
}

function settingsPage(tab="profile"){
  const app=document.getElementById("app");
  app.innerHTML=`
    <button onclick="home()">‚Üê back</button>
    <div class="tab">
      <button onclick="settingsPage('profile')">profile</button>
      <button onclick="settingsPage('custom')">customization</button>
    </div>

    ${tab==="profile"?`
      ${user.avatar?`<img src="${user.avatar}" style="width:80px;height:80px;border-radius:50%">`:""}
      <input placeholder="username" value="${user.name}"
        oninput="user.name=this.value;saveAll()">
      <input type="file" accept="image/*"
        onchange="uploadAvatar(this.files[0])">
    `:`
      ${themes.map(t=>`
        <div class="theme" style="background:${t.bg};color:#000"
          onclick="setTheme('${t.bg}')">${t.name}</div>
      `).join("")}

      ${["Pochacco","Kuromi","Cinnamoroll","Keroppi"].map(c=>`
        <button onclick="settings.character='${c}';saveAll();settingsPage('custom')">${c}</button>
      `).join("")}
    `}
  `;
}

function uploadAvatar(file){
  if(!file)return;
  const r=new FileReader();
  r.onload=()=>{user.avatar=r.result;saveAll();settingsPage();};
  r.readAsDataURL(file);
}

const themes=[
  {name:"light green",bg:"#e9fff2"},
  {name:"light blue",bg:"#eaf4ff"},
  {name:"light purple",bg:"#f3eaff"},
  {name:"light pink",bg:"#ffeaf4"},
  {name:"light gray",bg:"#f2f2f2"},
  {name:"black",bg:"#000000"},
  {name:"dark purple",bg:"#2b153f"},
  {name:"dark green",bg:"#0f2f1f"},
  {name:"dark blue",bg:"#0b1d3a"}
];

function setTheme(bg){
  settings.bg=bg;
  settings.text="#000000";
  saveAll();
  applyTheme();
  settingsPage("custom");
}

function newSubject(){
  const n=prompt("subject name");
  if(!n)return;
  data[n]={tasks:[],pins:[],notes:""};
  saveAll();
  home();
}

function openSubject(s){
  const subj=data[s];
  const app=document.getElementById("app");
  app.innerHTML=`
    <h1>${s}</h1>

    <div>üìå pinned tasks</div>
    ${subj.pins.map((p,i)=>`
      <div class="pin">
        ${p.text}
        <button onclick="deletePinned('${s}',${i})">‚úñ</button>
      </div>
    `).join("")}

    <div>üìù notes</div>
    <textarea rows="4" oninput="subjNotes('${s}',this.value)">${subj.notes}</textarea>

    <div>tasks</div>
    <input id="taskText">
    <button onclick="addTask('${s}')">add task</button>

    ${subj.tasks.map((t,i)=>`
      <div class="task ${t.done?"done":""}">
        <button class="delete" onclick="deleteTask('${s}',${i})">‚úñ</button>
        <input type="checkbox" ${t.done?"checked":""}
          onchange="toggle('${s}',${i})">
        ${t.text}
        <button onclick="pinTask('${s}',${i})">üìå</button>
      </div>
    `).join("")}

    <button onclick="home()">‚Üê back</button>
  `;
}

function subjNotes(s,v){ data[s].notes=v; saveAll(); }
function addTask(s){
  const t=document.getElementById("taskText").value;
  if(!t)return;
  data[s].tasks.push({text:t,done:false});
  saveAll();
  openSubject(s);
}

function toggle(s,i){
  data[s].tasks[i].done=!data[s].tasks[i].done;
  saveAll();
  openSubject(s);
}

function deleteTask(s,i){
  data[s].tasks.splice(i,1);
  saveAll();
  openSubject(s);
}

function pinTask(s,i){
  const task=data[s].tasks.splice(i,1)[0];
  data[s].pins.push(task);
  saveAll();
  openSubject(s);
}

function deletePinned(s,i){
  data[s].pins.splice(i,1);
  saveAll();
  openSubject(s);
}

function addInbox(){
  if(!data.Inbox)data.Inbox={tasks:[],pins:[],notes:""};
  const t=document.getElementById("quickTask").value;
  if(!t)return;
  data.Inbox.tasks.push({text:t,done:false});
  saveAll();
  home();
}

function start(){
  if(timer)return;
  timer=setInterval(()=>{
    time--;
    document.getElementById("time").textContent=format();
    if(time===0){
      clearInterval(timer);
      timer=null;
      document.getElementById("alarm").play();
      time = defaultMinutes * 60;
    }
  },1000);
}

function reset(){
  clearInterval(timer);
  timer=null;
  time = defaultMinutes * 60;
  home();
}

function format(){
  return Math.floor(time/60)+":"+String(time%60).padStart(2,"0");
}

home();
</script>
</body>
</html>
