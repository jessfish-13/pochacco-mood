<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Focus App</title>
<link href="https://fonts.googleapis.com/css2?family=Hubballi&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#e9fff2;
  --card:#ffffff;
  --accent:#4fbf90;
  --text:#000000;
}

body{
  margin:0;
  font-family:'Hubballi',sans-serif;
  background:var(--bg);
  color:var(--text);
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

.card{
  background:var(--card);
  width:390px;
  padding:18px;
  border-radius:22px;
  border:3px solid #c9f2dc;
  box-shadow:0 12px 30px rgba(0,0,0,0.08);
  max-height:92vh;
  overflow-y:auto;
  position:relative;
}

.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

button,input,textarea{
  width:100%;
  padding:8px;
  margin:5px 0;
  border-radius:14px;
  border:1px solid #bfead3;
  font-family:inherit;
}

button{
  background:#a8e6c8;
  border:none;
  cursor:pointer;
}

button:hover{background:#8fd9b6;}

.subject,.task,.pin{
  background:#f2fff8;
  padding:8px;
  border-radius:12px;
  margin:6px 0;
}

.task{
  position:relative;
  padding:8px 36px 8px 8px;
}

.task.done{
  opacity:0.5;
  text-decoration:line-through;
}

.task .delete{
  position:absolute;
  top:6px;
  right:10px;
  background:none;
  border:none;
  font-size:14px;
  cursor:pointer;
}

.pin{
  background:#e3fff1;
  border-left:4px solid var(--accent);
  position:relative;
}

.pin button{
  position:absolute;
  right:6px;
  top:6px;
  background:none;
  border:none;
  cursor:pointer;
}

.tab{
  display:flex;
  gap:8px;
  margin-bottom:10px;
}

.tab button{flex:1;}

.theme{
  padding:10px;
  border-radius:12px;
  margin:6px 0;
  cursor:pointer;
  text-align:center;
}

.character-img{
  position:absolute;
  bottom:12px;
  right:12px;
  width:80px;
  height:auto;
  pointer-events:none;
  opacity:0.9;
}
</style>
</head>

<body>
<div class="card" id="app"></div>

<audio id="alarm" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
const characterImages={
  Pochacco:"images/pochacco.png",
  Kuromi:"https://mystickermania.com/cdn/stickers/noob-pack/sanrio-kuromi-cute-512x512.png",
  Keroppi:"https://wallpapers.com/images/hd/keroppi-cartoon-frog-character-jy1tbdyay2a8xeil.jpg",
  Cinnamoroll:"images/cinnamaroll.png"
};

let data=JSON.parse(localStorage.getItem("pochacco"))||{};
let user=JSON.parse(localStorage.getItem("user"))||{name:"",avatar:""};
let settings=JSON.parse(localStorage.getItem("settings"))||{
  bg:"#e9fff2",
  text:"#000000",
  character:"Pochacco"
};

let time=25*60;
let timer=null;

const themes=[
  {name:"light green",bg:"#e9fff2"},
  {name:"light blue",bg:"#eaf4ff"},
  {name:"light purple",bg:"#f3eaff"},
  {name:"light pink",bg:"#ffeaf4"},
  {name:"light gray",bg:"#f2f2f2"},
  {name:"black",bg:"#000000"},
  {name:"dark purple",bg:"#2b153f"},
  {name:"dark green",bg:"#0f2f1f"},
  {name:"dark blue",bg:"#0b1d3a"}
];

function saveAll(){
  localStorage.setItem("pochacco",JSON.stringify(data));
  localStorage.setItem("user",JSON.stringify(user));
  localStorage.setItem("settings",JSON.stringify(settings));
}

function applyTheme(){
  document.documentElement.style.setProperty("--bg",settings.bg);
  document.documentElement.style.setProperty("--text","#000000");
}
applyTheme();

function home(){
  const app=document.getElementById("app");
  app.innerHTML=`
    <div class="topbar">
      <button onclick="settingsPage()">‚öô settings</button>
      <div>
        ${user.avatar?`<img src="${user.avatar}" style="width:32px;height:32px;border-radius:50%">`:""}
        ${user.name}
      </div>
    </div>

    <h1>üêæ ${settings.character} Focus</h1>

    <input id="quickTask" placeholder="quick task">
    <button onclick="addInbox()">add</button>

    <div>
      <div id="time">${format()}</div>
      <button onclick="start()">start</button>
      <button onclick="reset()">reset</button>
    </div>

    <button onclick="newSubject()">‚ûï subject</button>
    ${Object.keys(data).map(s=>`
      <div class="subject" onclick="openSubject('${s}')">${s}</div>
    `).join("")}

    ${characterImages[settings.character]
      ? `<img class="character-img" src="${characterImages[settings.character]}">`
      : ""}
  `;
}

function settingsPage(tab="profile"){
  const app=document.getElementById("app");
  app.innerHTML=`
    <button onclick="home()">‚Üê back</button>
    <div class="tab">
      <button onclick="settingsPage('profile')">profile</button>
      <button onclick="settingsPage('custom')">customization</button>
    </div>

    ${tab==="profile"?`
      ${user.avatar?`<img src="${user.avatar}" style="width:80px;height:80px;border-radius:50%">`:""}
      <input placeholder="username" value="${user.name}"
        oninput="user.name=this.value;saveAll()">
      <input type="file" accept="image/*"
        onchange="uploadAvatar(this.files[0])">
    `:`
      ${themes.map(t=>`
        <div class="theme" style="background:${t.bg}"
          onclick="setTheme('${t.bg}')">${t.name}</div>
      `).join("")}

      ${Object.keys(characterImages).map(c=>`
        <button onclick="settings.character='${c}';saveAll();settingsPage('custom')">${c}</button>
      `).join("")}
    `}
  `;
}

function uploadAvatar(file){
  if(!file)return;
  const r=new FileReader();
  r.onload=()=>{user.avatar=r.result;saveAll();settingsPage();};
  r.readAsDataURL(file);
}

function setTheme(bg){
  settings.bg=bg;
  saveAll();applyTheme();settingsPage("custom");
}

function newSubject(){
  const n=prompt("subject name");
  if(!n)return;
  data[n]={tasks:[],pins:[],notes:""};
  saveAll();home();
}

function openSubject(s){
  const subj=data[s];
  const app=document.getElementById("app");
  app.innerHTML=`
    <h1>${s}</h1>

    <div>üìå pinned tasks</div>
    ${subj.pins.map((p,i)=>`
      <div class="pin">
        ${p.text}
        <button onclick="deletePinned('${s}',${i})">‚úñ</button>
      </div>
    `).join("")}

    <div>üìù notes</div>
    <textarea rows="4" oninput="saveNotes('${s}',this.value)">${subj.notes}</textarea>

    <div>tasks</div>
    <input id="taskText">
    <button onclick="addTask('${s}')">add task</button>

    ${subj.tasks.map((t,i)=>`
      <div class="task ${t.done?"done":""}">
        <button class="delete" onclick="deleteTask('${s}',${i})">‚úñ</button>
        <input type="checkbox" ${t.done?"checked":""}
          onchange="toggle('${s}',${i})">
        ${t.text}
        <button onclick="pinTask('${s}',${i})">üìå</button>
      </div>
    `).join("")}

    <button onclick="home()">‚Üê back</button>

    ${characterImages[settings.character]
      ? `<img class="character-img" src="${characterImages[settings.character]}">`
      : ""}
  `;
}

function saveNotes(s,v){data[s].notes=v;saveAll();}
function addTask(s){
  const t=document.getElementById("taskText").value;
  if(!t)return;
  data[s].tasks.push({text:t,done:false});
  saveAll();openSubject(s);
}
function toggle(s,i){data[s].tasks[i].done=!data[s].tasks[i].done;saveAll();openSubject(s);}
function deleteTask(s,i){data[s].tasks.splice(i,1);saveAll();openSubject(s);}
function pinTask(s,i){data[s].pins.push(data[s].tasks.splice(i,1)[0]);saveAll();openSubject(s);}
function deletePinned(s,i){data[s].pins.splice(i,1);saveAll();openSubject(s);}

function addInbox(){
  if(!data.Inbox)data.Inbox={tasks:[],pins:[],notes:""};
  const t=document.getElementById("quickTask").value;
  if(!t)return;
  data.Inbox.tasks.push({text:t,done:false});
  saveAll();home();
}

function start(){
  if(timer)return;
  timer=setInterval(()=>{
    time--;
    document.getElementById("time").textContent=format();
    if(time===0){
      clearInterval(timer);
      timer=null;
      document.getElementById("alarm").play();
      time=25*60;
    }
  },1000);
}

function reset(){clearInterval(timer);timer=null;time=25*60;home();}
function format(){return Math.floor(time/60)+":"+String(time%60).padStart(2,"0");}

home();
</script>
</body>
</html>
