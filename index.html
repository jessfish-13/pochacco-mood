<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pochacco Focus üêæ</title>
<link href="https://fonts.googleapis.com/css2?family=Hubballi&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: 'Hubballi', sans-serif;
  background: linear-gradient(135deg, #e9fff2, #f4fff9);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.card {
  background: white;
  width: 390px;
  padding: 18px;
  border-radius: 22px;
  border: 3px solid #c9f2dc;
  box-shadow: 0 12px 30px rgba(0,0,0,0.08);
  max-height: 92vh;
  overflow-y: auto;
}

h1 {
  text-align:center;
  color:#4fbf90;
  margin:0;
}

.sub {
  text-align:center;
  font-size:13px;
  color:#7ac7a6;
  margin-bottom:10px;
}

input, textarea, select, button {
  font-family:'Hubballi',sans-serif;
  width:100%;
  padding:8px;
  margin:5px 0;
  border-radius:14px;
  border:1px solid #bfead3;
}

button {
  background:#a8e6c8;
  border:none;
  cursor:pointer;
}

button:hover {
  background:#8fd9b6;
}

.subject {
  background:#eafff3;
  padding:8px;
  border-radius:14px;
  margin:6px 0;
  text-align:center;
  cursor:pointer;
}

.task {
  background:#f2fff8;
  border-radius:12px;
  padding:8px;
  margin:6px 0;
}

.tag {
  font-size:11px;
  color:#4fbf90;
  margin-right:4px;
}

.pinned {
  background:#e3fff1;
  border-left:4px solid #4fbf90;
  padding:6px;
  margin:5px 0;
}

.timer {
  text-align:center;
  margin:10px 0;
}

.time {
  font-size:32px;
  color:#4fbf90;
}

.peace {
  text-align:center;
  margin-top:12px;
}

.paws {
  display:flex;
  justify-content:center;
  gap:10px;
  margin-top:6px;
}

.paw {
  width:36px;
  height:36px;
  background:#c9f2dc;
  border-radius:50%;
  cursor:pointer;
  transition:transform .1s;
}

.paw:active {
  transform:scale(0.75);
}
</style>
</head>

<body>
<div class="card" id="app"></div>

<script>
let data = JSON.parse(localStorage.getItem("pochacco")) || {};

// timer
let defaultMinutes = 25;
let time = defaultMinutes * 60;
let timer = null;
let sessions = 0;

function save() {
  localStorage.setItem("pochacco", JSON.stringify(data));
}

// HOME
function home() {
  const app = document.getElementById("app");
  app.innerHTML = `
    <h1>üêæ Pochacco Focus</h1>
    <div class="sub">focus. rest. squish.</div>

    <input id="quickTask" placeholder="quick task + #tags üçÉ">
    <button onclick="addInboxTask()">add task</button>

    <div class="timer">
      <div class="sub">focus time (minutes)</div>
      <input type="number" min="1" placeholder="25" id="customTime">
      <button onclick="setCustomTime()">set time</button>

      <div class="time" id="time">${formatTime()}</div>
      <button onclick="start()">start</button>
      <button onclick="reset()">reset</button>
      <div>sessions completed: ${sessions}</div>
    </div>

    <button onclick="newSubject()">‚ûï add subject</button>
    ${Object.keys(data).map(s=>`
      <div class="subject" onclick="openSubject('${s}')">${s}</div>
    `).join("")}

    <select>
      <option>how do you feel?</option>
      <option>üòä good</option>
      <option>üò¥ tired</option>
      <option>ü•∫ low</option>
      <option>üòµ stressed</option>
    </select>

    <div class="peace">
      peace corner üåø
      <div class="paws">
        <div class="paw"></div>
        <div class="paw"></div>
        <div class="paw"></div>
      </div>
    </div>
  `;
}

// CUSTOM TIME
function setCustomTime() {
  const input = document.getElementById("customTime");
  const minutes = parseInt(input.value);
  if (!minutes || minutes <= 0) return;
  defaultMinutes = minutes;
  reset();
}

// SUBJECT PAGE
function openSubject(s) {
  const subj = data[s];
  const app = document.getElementById("app");
  app.innerHTML = `
    <h1>${s}</h1>

    <div class="sub">pinned</div>
    ${subj.pins.map(p=>`<div class="pinned">${p}</div>`).join("")}
    <input id="pinText" placeholder="add pinned note">
    <button onclick="addPin('${s}')">pin</button>

    <div class="sub">notes</div>
    <textarea rows="4" oninput="saveNotes('${s}',this.value)">${subj.notes}</textarea>

    <div class="sub">tasks</div>
    <input id="taskText" placeholder="task + #tags">
    <input type="date" id="taskDate">
    <button onclick="addTask('${s}')">add task</button>

    ${subj.tasks.map((t,i)=>`
      <div class="task">
        ${t.text}
        <div>${t.tags.map(tag=>`<span class="tag">#${tag}</span>`).join("")}</div>
        ${t.date || ""}
        <button onclick="delTask('${s}',${i})">‚úñ</button>
      </div>
    `).join("")}

    <button onclick="home()">‚Üê back</button>
  `;
}

// SUBJECT LOGIC
function newSubject() {
  const name = prompt("subject name");
  if (!name) return;
  data[name] = { tasks:[], notes:"", pins:[] };
  save();
  home();
}

function addPin(s) {
  const text = document.getElementById("pinText").value;
  if (!text) return;
  data[s].pins.push(text);
  save();
  openSubject(s);
}

function saveNotes(s,v) {
  data[s].notes = v;
  save();
}

function addTask(s) {
  const text = document.getElementById("taskText").value;
  const date = document.getElementById("taskDate").value;
  if (!text) return;
  const tags = text.match(/#\w+/g)?.map(t=>t.slice(1)) || [];
  data[s].tasks.push({ text, date, tags });
  save();
  openSubject(s);
}

function delTask(s,i) {
  data[s].tasks.splice(i,1);
  save();
  openSubject(s);
}

// QUICK TASK
function addInboxTask() {
  const text = document.getElementById("quickTask").value;
  if (!text) return;
  if (!data["Inbox"]) data["Inbox"] = { tasks:[], notes:"", pins:[] };
  const tags = text.match(/#\w+/g)?.map(t=>t.slice(1)) || [];
  data["Inbox"].tasks.push({ text, date:"", tags });
  save();
  document.getElementById("quickTask").value = "";
}

// TIMER
function start() {
  if (timer) return;
  timer = setInterval(()=>{
    time--;
    document.getElementById("time").textContent = formatTime();
    if (time === 0) {
      clearInterval(timer);
      timer = null;
      sessions++;
      time = defaultMinutes * 60;
      home();
    }
  },1000);
}

function reset() {
  clearInterval(timer);
  timer = null;
  time = defaultMinutes * 60;
  home();
}

function formatTime() {
  const m = Math.floor(time/60);
  const s = time%60;
  return `${m}:${s.toString().padStart(2,"0")}`;
}

home();
</script>
</body>
</html>
